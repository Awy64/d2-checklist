<div class="childComponent">
  <div class="childVert">
    <div class="main">

      <div class="center-spinner">
        <mat-spinner class="loading" class="center-spinner" *ngIf="(loading|async)===true"></mat-spinner>
      </div>
      <div class="body-text">
        <h2 *ngIf="this.player!=null && this.player.profile!=null" class="centerMe">Vendors -
          <a [routerLink]="['/',this.player.profile.userInfo.membershipType, this.player.profile.userInfo.membershipId]"
            *ngIf="player!=null">{{player.profile.userInfo.displayName}} - {{selectedUser.userInfo.platformName}}</a>
        </h2>

        <div *ngIf="(loading|async)===false && player==null">
          <d2c-sign-in-required style="display:inline-block"></d2c-sign-in-required>
        </div>
        <mat-button-toggle-group #chargroup="matButtonToggleGroup" *ngIf="player!=null && player.characters!=null"
          [value]="char" (change)="router.navigate(['vendors',chargroup.value.characterId])">
          <mat-button-toggle *ngFor="let c of player.characters" [value]="c">
            {{c.className}}<span class="d-none d-md-inline"> - {{c.light}}</span>
          </mat-button-toggle>
        </mat-button-toggle-group>
        <br>
        <mat-button-toggle-group #optionsgroup="matButtonToggleGroup" *ngIf="player!=null && player.characters!=null"
          [value]="option" style="margin-top: 1em" (change)="navigateStuff(optionsgroup.value)">
          <mat-button-toggle *ngFor="let o of options" [value]="o">
            <fa-icon [icon]="iconService.farGift" *ngIf="o=='Bounties'"></fa-icon>
            <fa-icon [icon]="iconService.farCog" *ngIf="o=='Gear'"></fa-icon>
            <fa-icon [icon]="iconService.farBalanceScale" *ngIf="o=='Exchange'"></fa-icon>
            <fa-icon [icon]="iconService.farPalette" *ngIf="o=='Cosmetics'"></fa-icon>
            <span class="d-none d-md-inline"> {{o}}</span>
          </mat-button-toggle>
        </mat-button-toggle-group>

        <div style="margin: 10px">
          <mat-form-field class="searchField">
            <input matInput #filter placeholder="Filter items">
          </mat-form-field>
          <mat-checkbox class="hide-complete-triumphs" (change)="hideCompleted$.next($event.checked)" >
            Hide Completed
          </mat-checkbox>          
        </div>

        <ng-container *ngIf="!(loading|async)">

          <ng-container *ngIf="option=='Bounties'">
            <table class="tidy-auto-table itemTable" style="margin-top: 1em">
              <thead>
                <tr>
                  <th class="item-icon-cell"></th>
                  <th>Name</th>
                  <th>Objectives</th>
                  <th class="d-none d-sm-table-cell">Reward</th>
                  <th class="d-none d-sm-table-cell">Vendor</th>
                </tr>
              </thead>
              <tbody *ngIf="shoppingListHashes|async as sl">
                <ng-container *ngFor="let i of vendorData|async">
                  <tr
                    *ngIf="(i.type==ItemType.Bounty || i.type==ItemType.ForgeVessel) && includeItem(i, filterText$|async, hideCompleted$|async)">
                    <td class="item-icon-cell">
                      <span *ngIf="i.icon!=null" class="item-icon"
                        [style.background-image]="'url(//www.bungie.net' +i.icon + ')'"></span>
                    </td>
                    <td>
                      <div class="dashed-border bounty" [class.selected-dashed-border]="sl[i.hash]"
                        (click)="selectVendorBounty(i)">
                        <div class="bounty-title">
                          <span [matTooltip]="i.desc">
                            <ng-container *ngIf="i.lowLinks==null || i.lowLinks.mapLink==null">{{i.name}}
                            </ng-container>
                            <a [href]="i.lowLinks.mapLink" *ngIf="i.lowLinks!=null && i.lowLinks.mapLink!=null"
                              target="_blank" rel="noopener">
                              {{i.name}}
                              <fa-icon [icon]="iconService.farMapMarkerAlt" class="accent-text"></fa-icon>
                            </a>
                          </span>
                          <ng-container *ngIf="debugmode|async">{{i.hash}} {{i.status}} Tier: {{i.tierType}}
                          </ng-container><br>
                          <span class="type-caption">{{i.itemTypeAndTierDisplayName}}</span>
                        </div>
                        <div class="bounty-shopping-cart">
                          <fa-icon [icon]="iconService.falShoppingCart" 
                          [class.accent-text]="sl[i.hash]"
                          [class.disabled-text]="!sl[i.hash]"></fa-icon>
                        </div>
                      </div>
                    </td>

                    <td>
                      <div *ngFor="let o of i.objectives">
                        {{o.total}} {{o.units}}
                      </div>
                      <div *ngIf="i.tags">
                        <mat-chip-list aria-label="tags">
                          <mat-chip class="no-wrap-chip" *ngFor="let t of i.tags">{{t}}</mat-chip>
                        </mat-chip-list>
                      </div>
                    </td>
                    <td class="d-none d-sm-table-cell">
                      <div *ngFor="let v of i.values">
                        {{v.name}} <ng-container *ngIf="v.quantity>0">{{v.quantity}}</ng-container>
                        <span *ngIf="debugmode|async"> {{v.hash}}</span>
                      </div>
                    </td>
                    <td class="d-none d-sm-table-cell">
                      {{i.vendor.name}}
                      <span class="type-caption">Resets in {{ i.vendor.nextRefreshDate | amDifference: today |
                        amDuration:'ms'}}</span>
                      <div *ngFor="let c of i.costs">
                        <small>{{c.name}} {{c.quantity}}</small>
                      </div>
                      <div *ngIf="i.status!=null" class="warn-text">
                        <small>{{i.status}}</small>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngIf="option=='Gear'">
            <table class="tidy-auto-table itemTable" style="margin-top: 1em">
              <thead>
                <tr>
                  <th class="item-icon-cell hide-mobile-table-cell"></th>
                  <th>Name</th>
                  <th class="d-none d-md-table-cell">Vendor</th>
                </tr>

              </thead>
              <tbody>
                <ng-container *ngFor="let i of vendorData|async">
                  <tr
                    *ngIf="((i.type==ItemType.Armor || i.type==ItemType.Weapon ) || i.type==ItemType.GearMod) && includeItem(i, filterText$|async)">
                    <td class="item-icon-cell">
                      <span *ngIf="i.icon!=null" class="item-icon"
                        [style.background-image]="'url(//www.bungie.net' +i.icon + ')'"></span>
                    </td>
                    <td>
                      <ng-container *ngIf="i.lowLinks==null || i.lowLinks.mapLink==null">{{i.name}} </ng-container>
                      <a [href]="i.lowLinks.mapLink" *ngIf="i.lowLinks!=null && i.lowLinks.mapLink!=null"
                        target="_blank" rel="noopener">
                        {{i.name}}
                        <fa-icon [icon]="iconService.farMapMarkerAlt" class="accent-text"></fa-icon>
                      </a>
                      <ng-container *ngIf="debugmode|async">{{i.hash}} {{i.status}}</ng-container><br>
                      <span class="type-caption">{{i.itemTypeAndTierDisplayName}}</span>
                      <div class="d-block d-md-none">{{i.vendor.name}}</div>
                    </td>
                    <td class="d-none d-md-table-cell">
                      {{i.vendor.name}}
                      <span class="type-caption">Resets in {{ i.vendor.nextRefreshDate | amDifference: today |
                        amDuration:'ms'}}</span>
                      <div *ngFor="let c of i.costs">
                        <small>{{c.name}} {{c.quantity}}</small>
                      </div>
                      <div *ngIf="i.status!=null" class="warn-text">
                        <small>{{i.status}}</small>
                      </div>
                    </td>

                  </tr>
                </ng-container>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngIf="option=='Cosmetics'">
            <table class="tidy-auto-table itemTable" style="margin-top: 1em">
              <thead>
                <tr>
                  <th class="item-icon-cell"></th>
                  <th>Name</th>
                  <th>Vendor</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let i of vendorData|async">
                  <tr
                    *ngIf="(i.type==ItemType.Ship || i.type==ItemType.Vehicle || i.type==ItemType.Emote  || i.type==ItemType.Ghost) && includeItem(i, filterText$|async)">
                    <td class="item-icon-cell">
                      <span *ngIf="i.icon!=null" class="item-icon"
                        [style.background-image]="'url(//www.bungie.net' +i.icon + ')'"></span>
                    </td>
                    <td>
                      <ng-container *ngIf="i.lowLinks==null || i.lowLinks.mapLink==null">{{i.name}} </ng-container>
                      <a [href]="i.lowLinks.mapLink" *ngIf="i.lowLinks!=null && i.lowLinks.mapLink!=null"
                        target="_blank" rel="noopener">
                        {{i.name}}
                        <fa-icon [icon]="iconService.farMapMarkerAlt" class="accent-text"></fa-icon>
                      </a>
                      <ng-container *ngIf="debugmode|async">{{i.hash}} {{i.status}}</ng-container><br>
                      {{i.itemTypeAndTierDisplayName}}
                    </td>
                    <td>
                      {{i.vendor.name}}
                      <span class="type-caption">Resets in {{ i.vendor.nextRefreshDate | amDifference: today |
                        amDuration:'ms'}}</span>
                      <div *ngFor="let c of i.costs">
                        <small>{{c.name}} {{c.quantity}}</small>
                      </div>
                      <div *ngIf="i.status!=null" class="warn-text">
                        <small>{{i.status}}</small>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngIf="option=='Exchange'">
            <table class="tidy-auto-table itemTable" style="margin-top: 1em">
              <thead>
                <tr>
                  <th class="item-icon-cell"></th>
                  <th>Name</th>
                  <th>Vendor</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let i of vendorData|async">
                  <tr *ngIf="(i.type==ItemType.Dummy) && i.vendor.name=='Spider'   && includeItem(i, filterText$|async)">
                    <td class="item-icon-cell">
                      <span *ngIf="i.icon!=null" class="item-icon"
                        [style.background-image]="'url(//www.bungie.net' +i.icon + ')'"></span>
                    </td>
                    <td>
                      <ng-container *ngIf="i.lowLinks==null || i.lowLinks.mapLink==null">{{i.name}} </ng-container>
                      <a [href]="i.lowLinks.mapLink" *ngIf="i.lowLinks!=null && i.lowLinks.mapLink!=null"
                        target="_blank" rel="noopener">
                        {{i.name}}
                        <fa-icon [icon]="iconService.farMapMarkerAlt" class="accent-text"></fa-icon>
                      </a>
                      <br>
                      Quantity: {{i.quantity}}
                    </td>
                    <td>
                      {{i.vendor.name}}
                      <span class="type-caption">Resets in {{ i.vendor.nextRefreshDate | amDifference: today |
                        amDuration:'ms'}}</span>
                      <div *ngFor="let c of i.costs">
                        <small>Cost: {{c.name}} {{c.quantity}}</small>
                      </div>
                      <div *ngIf="i.status!=null" class="warn-text">
                        <small>{{i.status}}</small>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </ng-container>
        </ng-container>
      </div>
    </div>
    <div *ngIf="(disableAds|async)!==true" class="adRight">
      <small class="adText">Advertisement</small>
      <ng-adsense adFormat="vertical"></ng-adsense>
    </div>
  </div>
  <div *ngIf="(disableAds|async)!==true" class="adBottom">
    <small class="adText">Advertisement</small>
    <ng-adsense adSlot="7909243132" display="inline-block" width="336" height="280"></ng-adsense>
  </div>
</div>